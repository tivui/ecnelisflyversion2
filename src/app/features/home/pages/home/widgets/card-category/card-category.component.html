<mat-card class="category-card" (click)="onCardClick($event)">
  <mat-card-header>
    <img
      [src]="overlay()"
      [alt]="title()"
      class="category-overlay"
    />
    <div class="category-label">
      <span class="category-dot" [style.background]="accentColor()" [style.--dot-color]="accentColor()"></span>
      <mat-card-title>{{ title() }}</mat-card-title>
    </div>
  </mat-card-header>

  <mat-card-content>
    @if (selectedSubCategory) {
      <div class="subcategory-preview">
        <span class="preview-dot" [style.background]="accentColor()"></span>
        <span class="preview-label">{{ selectedSubCategory.label }}</span>
        <button mat-icon-button class="preview-close" (click)="clearSelection()">
          <mat-icon>close</mat-icon>
        </button>
        <button mat-flat-button class="preview-cta" [style.background]="accentColor()" (click)="confirmNavigation()">
          {{ 'categories.explore' | translate }}
          <mat-icon iconPositionEnd>arrow_forward</mat-icon>
        </button>
      </div>
    } @else {
      <mat-form-field class="subcategory-field" appearance="outline">
        <mat-icon matPrefix class="search-icon">search</mat-icon>
        <input
          type="text"
          matInput
          [formControl]="subCategoryControl"
          [matAutocomplete]="auto"
          [placeholder]="'categories.searchPlaceholder' | translate"
        />

        <mat-autocomplete
          #auto="matAutocomplete"
          autoActiveFirstOption
          [displayWith]="displayFn.bind(this)"
          (optionSelected)="onSelectSubCategory($event.option.value)"
        >
          @for (opt of filteredLists; track opt.key) {
            <mat-option [value]="opt">
              {{ opt.label }}
            </mat-option>
          } @empty {
            <mat-option disabled>{{ 'categories.noResult' | translate }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
    }
  </mat-card-content>
</mat-card>
