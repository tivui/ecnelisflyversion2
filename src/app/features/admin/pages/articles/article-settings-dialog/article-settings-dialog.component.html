<h2 mat-dialog-title>{{ 'admin.articles.settings.title' | translate }}</h2>

<mat-dialog-content>
  <mat-tab-group>
    <!-- General Tab -->
    <mat-tab [label]="'admin.articles.settings.general' | translate">
      <form [formGroup]="form" class="form-content">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'admin.articles.settings.fields.title' | translate }}</mat-label>
          <input matInput formControlName="title" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'admin.articles.settings.fields.description' | translate }}</mat-label>
          <textarea matInput formControlName="description" rows="3"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'admin.articles.settings.fields.slug' | translate }}</mat-label>
          <input matInput formControlName="slug" placeholder="auto-generated" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'admin.articles.settings.fields.author' | translate }}</mat-label>
          <input matInput formControlName="authorName" />
        </mat-form-field>

        <div class="row">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'admin.articles.settings.fields.status' | translate }}</mat-label>
            <mat-select formControlName="status">
              @for (status of statuses; track status) {
                <mat-option [value]="status">
                  {{ 'admin.articles.status.' + status | translate }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'admin.articles.settings.fields.sortOrder' | translate }}</mat-label>
            <input matInput type="number" formControlName="sortOrder" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'admin.articles.list.columns.readingTime' | translate }}</mat-label>
            <input matInput type="number" formControlName="readingTimeMinutes" />
            <span matSuffix>min</span>
            @if (calculatedReadingTime()) {
              <mat-hint>{{ 'admin.articles.settings.calculatedTime' | translate:{ count: calculatedReadingTime() } }}</mat-hint>
            }
          </mat-form-field>
        </div>
      </form>
    </mat-tab>

    <!-- Translations Tab -->
    <mat-tab [label]="'admin.articles.settings.translations' | translate">
      <form [formGroup]="form" class="form-content">
        <h4>Titre</h4>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>FR</mat-label>
          <input matInput formControlName="title_fr" />
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>EN</mat-label>
          <input matInput formControlName="title_en" />
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>ES</mat-label>
          <input matInput formControlName="title_es" />
        </mat-form-field>

        <h4>Description</h4>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>FR</mat-label>
          <textarea matInput formControlName="description_fr" rows="2"></textarea>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>EN</mat-label>
          <textarea matInput formControlName="description_en" rows="2"></textarea>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>ES</mat-label>
          <textarea matInput formControlName="description_es" rows="2"></textarea>
        </mat-form-field>
      </form>
    </mat-tab>

    <!-- Media & Tags Tab -->
    <mat-tab [label]="'admin.articles.settings.media' | translate">
      <div class="form-content">
        <!-- Cover Image -->
        <div class="cover-section">
          <label>{{ 'admin.articles.settings.fields.coverImage' | translate }}</label>

          @if (coverPreviewUrl()) {
            <img [src]="coverPreviewUrl()" alt="Cover" class="cover-preview" />
          }

          <div class="upload-row">
            <button mat-stroked-button (click)="coverInput.click()" [disabled]="uploadingCover()">
              <mat-icon>upload</mat-icon>
              {{ uploadingCover() ? 'Uploading...' : 'admin.articles.settings.fields.coverImage' | translate }}
            </button>
            <input
              #coverInput
              type="file"
              accept="image/*"
              hidden
              (change)="onCoverFileSelected($event)"
            />
            @if (uploadingCover()) {
              <mat-spinner diameter="24"></mat-spinner>
            }
          </div>
        </div>

        <!-- Tags -->
        <div class="tags-section">
          <label>{{ 'admin.articles.settings.fields.tags' | translate }}</label>
          <mat-chip-grid #chipGrid>
            @for (tag of tags(); track tag) {
              <mat-chip-row (removed)="removeTag(tag)">
                {{ tag }}
                <button matChipRemove>
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
            }
          </mat-chip-grid>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'admin.articles.settings.fields.addTag' | translate }}</mat-label>
            <input
              matInput
              [matChipInputFor]="chipGrid"
              [matChipInputSeparatorKeyCodes]="separatorKeyCodes"
              (matChipInputTokenEnd)="addTag($event)"
            />
          </mat-form-field>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">
    {{ 'common.action.cancel' | translate }}
  </button>
  <button
    mat-raised-button
    color="primary"
    (click)="save()"
    [disabled]="saving() || !form.valid"
  >
    @if (saving()) {
      <mat-spinner diameter="20"></mat-spinner>
    } @else {
      {{ 'common.action.save' | translate }}
    }
  </button>
</mat-dialog-actions>
