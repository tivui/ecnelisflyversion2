<h2 mat-dialog-title>
  {{ (isEditMode() ? 'admin.journeys.dialog.editTitle' : 'admin.journeys.dialog.createTitle') | translate }}
</h2>

<mat-dialog-content>
  <mat-tab-group>
    <!-- Info Tab -->
    <mat-tab [label]="'admin.journeys.dialog.tabInfo' | translate">
      <div class="tab-content">
        <form [formGroup]="form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'admin.journeys.dialog.name' | translate }}</mat-label>
            <input matInput formControlName="name" required />
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'admin.journeys.dialog.slug' | translate }}</mat-label>
            <input matInput formControlName="slug" required />
            <mat-hint>{{ 'admin.journeys.dialog.slugHint' | translate }}</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'admin.journeys.dialog.description' | translate }}</mat-label>
            <textarea matInput formControlName="description" rows="3"></textarea>
          </mat-form-field>

          <div class="row">
            <mat-form-field appearance="outline">
              <mat-label>{{ 'admin.journeys.dialog.color' | translate }}</mat-label>
              <input matInput type="color" formControlName="color" />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'admin.journeys.dialog.sortOrder' | translate }}</mat-label>
              <input matInput type="number" formControlName="sortOrder" />
            </mat-form-field>
          </div>

          <mat-slide-toggle formControlName="isPublic">
            {{ 'admin.journeys.dialog.isPublic' | translate }}
          </mat-slide-toggle>
        </form>
      </div>
    </mat-tab>

    <!-- Media Tab -->
    <mat-tab [label]="'admin.journeys.dialog.tabMedia' | translate">
      <div class="tab-content media-tab">
        <div class="media-section">
          <h4>{{ 'admin.journeys.dialog.coverImage' | translate }}</h4>
          <p class="media-hint">{{ 'admin.journeys.dialog.coverImageHint' | translate }}</p>

          @if (coverImagePreviewUrl()) {
            <div
              class="media-preview image-preview image-draggable"
              [class.dragging]="isDraggingImage()"
              (mousedown)="onImageDragStart($event)"
              (mousemove)="onImageDragMove($event)"
              (mouseup)="onImageDragEnd()"
              (mouseleave)="onImageDragEnd()"
              (touchstart)="onImageTouchStart($event)"
              (touchmove)="onImageTouchMove($event)"
              (touchend)="onImageDragEnd()"
              (wheel)="onImageWheel($event)"
            >
              <img
                [src]="coverImagePreviewUrl()"
                alt="Cover"
                [style.object-position]="'center ' + coverImagePosition()"
                [style.transform]="'scale(' + coverImageZoom() / 100 + ')'"
                draggable="false"
              />
              <button mat-icon-button class="remove-media-btn" (click)="removeCoverImage(); $event.stopPropagation()">
                <mat-icon>close</mat-icon>
              </button>
              <div class="drag-hint">
                <mat-icon>open_with</mat-icon>
                <span>{{ 'admin.journeys.dialog.dragToFrame' | translate }}</span>
              </div>
            </div>
            <div class="zoom-controls">
              <button mat-icon-button (click)="zoomOut()" [disabled]="coverImageZoom() <= 100">
                <mat-icon>remove</mat-icon>
              </button>
              <span class="zoom-label">{{ coverImageZoom() }}%</span>
              <button mat-icon-button (click)="zoomIn()" [disabled]="coverImageZoom() >= 200">
                <mat-icon>add</mat-icon>
              </button>
              @if (coverImageZoom() > 100) {
                <button mat-icon-button (click)="resetZoom()" class="zoom-reset">
                  <mat-icon>restart_alt</mat-icon>
                </button>
              }
            </div>
          } @else {
            <div
              class="drop-zone"
              (click)="coverImageInput.click()"
              (dragover)="onDragOver($event)"
              (drop)="onDropImage($event)"
            >
              <mat-icon>image</mat-icon>
              <span>{{ 'admin.journeys.dialog.uploadImage' | translate }}</span>
            </div>
          }

          <input
            #coverImageInput
            type="file"
            accept="image/jpeg,image/png,image/webp"
            hidden
            (change)="onCoverImageSelected($event)"
          />

          @if (imageUploadProgress() > 0 && imageUploadProgress() < 100) {
            <mat-progress-bar mode="determinate" [value]="imageUploadProgress()"></mat-progress-bar>
          }
        </div>
      </div>
    </mat-tab>

    <!-- Translations Tab -->
    <mat-tab [label]="'admin.journeys.dialog.tabTranslations' | translate">
      <div class="tab-content">
        <form [formGroup]="form">
          <h4>{{ 'admin.journeys.dialog.nameTranslations' | translate }}</h4>
          <div class="translations-grid">
            <mat-form-field appearance="outline">
              <mat-label>Français</mat-label>
              <input matInput formControlName="name_fr" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>English</mat-label>
              <input matInput formControlName="name_en" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Español</mat-label>
              <input matInput formControlName="name_es" />
            </mat-form-field>
          </div>

          <h4>{{ 'admin.journeys.dialog.descriptionTranslations' | translate }}</h4>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Français</mat-label>
            <textarea matInput formControlName="description_fr" rows="2"></textarea>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>English</mat-label>
            <textarea matInput formControlName="description_en" rows="2"></textarea>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Español</mat-label>
            <textarea matInput formControlName="description_es" rows="2"></textarea>
          </mat-form-field>
        </form>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()" [disabled]="saving()">
    {{ 'common.action.cancel' | translate }}
  </button>
  <button
    mat-raised-button
    color="primary"
    (click)="save()"
    [disabled]="saving() || !form.valid"
  >
    @if (saving()) {
      <mat-spinner diameter="20"></mat-spinner>
    } @else {
      {{ 'common.action.save' | translate }}
    }
  </button>
</mat-dialog-actions>
